<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>iOS 响应者链条 | jeversone&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="1.源起最近在面试，好基友池子跑过来对我说：响应者链这是个必考点，一般会这么问：响应者事件传递顺序是什么, 响应者的响应顺序是什么？ 池子认为事件传递的过程是自上而下的，事件响应是自下而上而上的。为此和池子争论了一番。争议点在事件传递上，就此达成一致的是响应者链的顺序是自上而下的。Jeverson认为响应者链寻找最合适的（第一响应者）响应者调用HitTest的过程–事件响应，找到第一响应者发现没有">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS 响应者链条">
<meta property="og:url" content="https://jeversonjee.github.io/blog/2022/02/25/ios/hittest/index.html">
<meta property="og:site_name" content="jeversone&#39;s blog">
<meta property="og:description" content="1.源起最近在面试，好基友池子跑过来对我说：响应者链这是个必考点，一般会这么问：响应者事件传递顺序是什么, 响应者的响应顺序是什么？ 池子认为事件传递的过程是自上而下的，事件响应是自下而上而上的。为此和池子争论了一番。争议点在事件传递上，就此达成一致的是响应者链的顺序是自上而下的。Jeverson认为响应者链寻找最合适的（第一响应者）响应者调用HitTest的过程–事件响应，找到第一响应者发现没有">
<meta property="og:locale">
<meta property="article:published_time" content="2022-02-25T06:41:24.000Z">
<meta property="article:modified_time" content="2022-11-19T08:00:00.000Z">
<meta property="article:author" content="jeversonjee">
<meta property="article:tag" content="ios;crossplatform;react-native;objc;android">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/blog/atom.xml" title="jeversone's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/blog/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/blog/css/style.css">

  
    
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">jeversone&#39;s blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">talk is cheap</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://jeversonjee.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-ios/hittest" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2022/02/25/ios/hittest/" class="article-date">
  <time class="dt-published" datetime="2022-02-25T06:41:24.000Z" itemprop="datePublished">2022-02-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      iOS 响应者链条
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1-源起"><a href="#1-源起" class="headerlink" title="1.源起"></a>1.源起</h2><p>最近在面试，好基友<code>池子</code>跑过来对我说：<code>响应者链</code>这是个必考点，一般会这么问：<code>响应者事件传递顺序是什么, 响应者的响应顺序是什么？</code></p>
<p><code>池子</code>认为事件传递的过程是<code>自上而下</code>的，事件响应<code>是自下而上</code>而上的。为此和<code>池子</code>争论了一番。争议点在<code>事件传递</code>上，就此达成一致的是<code>响应者链</code>的顺序是<code>自上而下</code>的。<del><code>Jeverson</code>认为<code>响应者链</code>寻找<code>最合适的（第一响应者）响应者调用HitTest</code>的过程–<code>事件响应</code>，找到<code>第一响应者</code>发现没有相应的处理函数，向上传递事件的过程–<code>事件传递</code>。</del> <code>池子</code>则认为相反。</p>
<h3 id="1-1RunLoop-是如何响应事件的？"><a href="#1-1RunLoop-是如何响应事件的？" class="headerlink" title="1.1RunLoop 是如何响应事件的？"></a>1.1RunLoop 是如何响应事件的？</h3><p>Apple 注册了一个 <code>Source1</code>(基于<code>mach_port</code> 的)用来接收系统事件，其回调函数为<code>__IOHIDEventSystemClientQueueCallBack().</code></p>
<p>当一个硬件事件(触摸&#x2F;锁屏&#x2F;摇晃等)发生后，首先由<code>IOKit.framework </code>生成一个<code>IOHIDEvent</code> 事件并由<code>SrpingBoard</code> 接收</p>
<p><code>SpringBoard</code> 只接收按键(锁屏&#x2F;静音)、触摸，加速，接近传感器等几种<code>Event</code>，随后用<code> mach_port</code> 转发给需要的 <code>App</code>进程。随后苹果注册的那个 <code>Source1</code>就会触发触发回调，并调用<code>_UIApplicationHandleEventQueue()</code> 进行应用的内部分发。</p>
<p><code>_UIApplicationHandleEventQueue()</code> 会把<code>IOHIDEvent</code> 处理并包装成<code>UIEvent </code>进行处理或分发，其中包括识别 <code>UIGesture/处理屏幕旋转/发送给 UIWindow</code>等。通常事件比如<code>UIButton点击 、touchesBegin/move/end/cancel</code> 事件都是在这个回调中完成的。</p>
<h3 id="1-2-说明"><a href="#1-2-说明" class="headerlink" title="1.2 说明"></a>1.2 说明</h3><p>因<code>Jeverson</code>在面试中遇到过两位<code>面试官</code>,两个人对<code>事件传递</code>就如何<code>池子</code>和<code>Jevreson</code>一样。而本人呢却刚好巧妙的避开<code>两位面试官</code>的理解。故本文就抛开歧义，全面理解<code>HitTest</code>,<code>响应者链</code>。并参照池子对两争议名词的理解开展。</p>
<h3 id="2-响应者-Responder"><a href="#2-响应者-Responder" class="headerlink" title="2.响应者(Responder)"></a>2.响应者(Responder)</h3><p>上面讲述到<code>_UIApplicationHandleEventQueue()</code> 将<code>UIEvent</code>进行处理或分发给<code>window</code>,接着是如何找出<code>最佳响应者（responder）</code>， 这里就要引入<code>UIview</code> 的两个方法：</p>
<ul>
<li><code>-(UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event</code></li>
<li><code>-(BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event</code><br>方法一：返回视图层级结构，并显示第一响应者<br>方法二：返回点击是否在该视图中</li>
</ul>
<h3 id="2-1-响应者一瞥"><a href="#2-1-响应者一瞥" class="headerlink" title="2.1 响应者一瞥"></a>2.1 响应者一瞥</h3><p>上面讲到过，<code>UIView</code>的两个重要方法；那我们来定义一个嵌套涂层来一探这两个方法的调用过程。我们的示例参照<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/4961386/event-handling-for-ios-how-hittestwithevent-and-pointinsidewithevent-are-r">stackoverflow</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----------------------------+</span><br><span class="line">|A                           |</span><br><span class="line">|+--------+   +------------+ |</span><br><span class="line">||B       |   |C           | |</span><br><span class="line">||        |   |+----------+| |</span><br><span class="line">|+--------+   ||D         || |</span><br><span class="line">|             |+----------+| |</span><br><span class="line">|             +------------+ |</span><br><span class="line">+----------------------------+</span><br></pre></td></tr></table></figure>

<p>手指在<code>D</code>上点击究竟发生了什么，<code>hitTest:withEvent:</code>, <code>pointInside:withEvent:</code>发生了什么，让我们来一探究竟究竟。</p>
<h2 id="2-2-通过Category以交换方法的方式一探究竟"><a href="#2-2-通过Category以交换方法的方式一探究竟" class="headerlink" title="2.2 通过Category以交换方法的方式一探究竟"></a>2.2 通过<code>Category</code>以<code>交换方法</code>的方式一探究竟</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="type">void</span>)load &#123;</span><br><span class="line">    Method originHitTest = class_getInstanceMethod([<span class="built_in">UIView</span> <span class="keyword">class</span>], <span class="keyword">@selector</span>(hitTest:withEvent:));</span><br><span class="line">    Method customHitTest = class_getInstanceMethod([<span class="built_in">UIView</span> <span class="keyword">class</span>], <span class="keyword">@selector</span>(jj_hitTest:withEvent:));</span><br><span class="line">    method_exchangeImplementations(originHitTest, customHitTest);</span><br><span class="line"></span><br><span class="line">    Method originPointInside = class_getInstanceMethod([<span class="built_in">UIView</span> <span class="keyword">class</span>], <span class="keyword">@selector</span>(pointInside:withEvent:));</span><br><span class="line">    Method customPointInside = class_getInstanceMethod([<span class="built_in">UIView</span> <span class="keyword">class</span>], <span class="keyword">@selector</span>(jj_pointInside:withEvent:));</span><br><span class="line">    method_exchangeImplementations(originPointInside, customPointInside);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIView</span> *)jj_hitTest:(<span class="built_in">CGPoint</span>)point withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%@ hitTest&quot;</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]));</span><br><span class="line">    <span class="built_in">UIView</span> *view = [<span class="keyword">self</span> jj_hitTest:point withEvent:event];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%@ hitTest return %@&quot;</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]), <span class="built_in">NSStringFromClass</span>([view <span class="keyword">class</span>]));</span><br><span class="line">    <span class="keyword">return</span> view;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">BOOL</span>)jj_pointInside:(<span class="built_in">CGPoint</span>)point withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%@ pointInside&quot;</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]));</span><br><span class="line">    <span class="type">BOOL</span> result = [<span class="keyword">self</span> jj_pointInside:point withEvent:event];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%@ pointInside return %@&quot;</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]), (result?<span class="string">@&quot;true&quot;</span>:<span class="string">@&quot;false&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-log"><a href="#2-3-log" class="headerlink" title="2.3 log"></a>2.3 log</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.187599</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIWindow</span> hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.187789</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIWindow</span> pointInside</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.187892</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIWindow</span> pointInside <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.187998</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UITransitionView</span> hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.188105</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UITransitionView</span> pointInside</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.188200</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UITransitionView</span> pointInside <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.188290</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIDropShadowView</span> hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.188399</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIDropShadowView</span> pointInside</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.188712</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIDropShadowView</span> pointInside <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.189025</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">AView</span> hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.189276</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">AView</span> pointInside</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.189609</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">AView</span> pointInside <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.189910</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] CView hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.190180</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] CView pointInside</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.190461</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] CView pointInside <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.190727</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] DView hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.190984</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] DView pointInside</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.191231</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] DView pointInside <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.191497</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UILabel</span> hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.191759</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UILabel</span> hitTest <span class="keyword">return</span> (null)</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.192088</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] DView hitTest <span class="keyword">return</span> DView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.193328</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] CView hitTest <span class="keyword">return</span> DView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.193609</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">AView</span> hitTest <span class="keyword">return</span> DView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.193836</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIDropShadowView</span> hitTest <span class="keyword">return</span> DView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.194166</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UITransitionView</span> hitTest <span class="keyword">return</span> DView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.194396</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIWindow</span> hitTest <span class="keyword">return</span> DView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.194743</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIWindow</span> hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.195022</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIWindow</span> pointInside</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.195276</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIWindow</span> pointInside <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.195509</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UITransitionView</span> hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.195889</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UITransitionView</span> pointInside</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.196137</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UITransitionView</span> pointInside <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.201222</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIDropShadowView</span> hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.201357</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIDropShadowView</span> pointInside</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.201451</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIDropShadowView</span> pointInside <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.201550</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">AView</span> hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.201648</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">AView</span> pointInside</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.201740</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">AView</span> pointInside <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.201830</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] CView hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.202077</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] CView pointInside</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.202335</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] CView pointInside <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.202581</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] DView hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.202853</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] DView pointInside</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.203083</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] DView pointInside <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.203344</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UILabel</span> hitTest</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.203607</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UILabel</span> hitTest <span class="keyword">return</span> (null)</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.203868</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] DView hitTest <span class="keyword">return</span> DView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.204110</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] CView hitTest <span class="keyword">return</span> DView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.204367</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">AView</span> hitTest <span class="keyword">return</span> DView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.204641</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIDropShadowView</span> hitTest <span class="keyword">return</span> DView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.204916</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UITransitionView</span> hitTest <span class="keyword">return</span> DView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">12.205192</span>+<span class="number">0800</span> ResponserChain[<span class="number">16154</span>:<span class="number">291200</span>] <span class="built_in">UIWindow</span> hitTest <span class="keyword">return</span> DView</span><br></pre></td></tr></table></figure>

<p>日志中不难看出<code>hitTest:withEvent</code> 、<code>pointInside:withEvent</code>的调用是从<code>window</code>开始的;值得注意的是，<strong>A 执行完成之后的调用，并没有调用与 C 同级的 B 的方法</strong>，<em>主要是因为子视图的调用顺序是从后向前的</em> 而 C 是在 B 之后并且调用 C 之后返回的是<code>true</code>故这里并没有再去遍历 B。这里引用 Apple 的解释<code>hitTest:withEvent 返回包含指定点的视图层次结构（包括其自身）中接收器的最远后代。</code>然后找到最佳响应者<code>DView</code>，值得注意的是此处的<code>Label 的userInteraction</code>没有打开。因为<code>Label</code>是 View 的子试图，所以还有一次递归调用，返回是<code>Returns the farthest descendant of the receiver in the view hierarchy (including itself) that contains a specified point.</code></p>
<h3 id="2-4-总结"><a href="#2-4-总结" class="headerlink" title="2.4 总结"></a>2.4 总结</h3><p>1、最佳响应者寻找的方式是通过<code>hitTest:withEvent</code>和<code>pointInside</code> 来完成的<br>2、<code>hitTest</code>的调用是从<code>window</code>开始的，<code>子视图</code>的调用方式是<code>从后向前</code>。<br>3、递归调用找到最合适的响应者，并<code>返回包含指定点的视图层次结构（包括其自身）中接收器的最远后代</code></p>
<h2 id="3-处理者"><a href="#3-处理者" class="headerlink" title="3.处理者"></a>3.处理者</h2><p>找到了最佳响应者，那么手势识别的过程是怎样的呢？</p>
<h3 id="3-1-手势识别"><a href="#3-1-手势识别" class="headerlink" title="3.1 手势识别"></a>3.1 手势识别</h3><p>当上面的<code>_UIApplicationHandleEventQueue()</code>识别了一个手势，其首先会调用<code>cancel</code> 将当前的<code>touchesBegin/move/end</code> 系列回调打断。随后系统将对应的<code>UIGestureRecoginizer</code> 标记为<code>待处理</code>。</p>
<p>苹果注册了一个<code>observer</code> 监测 <code>beforeWaiting</code>（Loop 即将进入休眠）事件，这个<code>observer</code>的回调函数是<code>_UIGestureRecognizerUpdateObserver()</code>,其内部会获取刚被标记为待处理的 GestureRecognizer，并执行 GestureRecognizer 的回调。当有 UIGestureRecognizer 的变化（<code>创建/销毁/改变状态</code>）是，这个回调都会进行相应的处理。</p>
<h3 id="3-2-事件传递"><a href="#3-2-事件传递" class="headerlink" title="3.2 事件传递"></a>3.2 事件传递</h3><p>我们在 View<code>D</code>的<code>touch</code> 事件，View<code>D</code>作为最佳响应者，理应处理事件。但是我们这边并没有处理（重写<code>touchesBegin/move/end</code> 的方法）。那么事件将会被传递，那么<code>D</code>的下一个响应者是谁，谁来处理，事件在传递的过程中若响应者链中没有处理那么终将被废弃掉。<br>那么我们来一探事件传递的过程。</p>
<h3 id="3-3-D-的响应者链是什么"><a href="#3-3-D-的响应者链是什么" class="headerlink" title="3.3 D 的响应者链是什么"></a>3.3 D 的响应者链是什么</h3><h3 id="3-3-1-代码探究nextResponder"><a href="#3-3-1-代码探究nextResponder" class="headerlink" title="3.3.1 代码探究nextResponder"></a>3.3.1 代码探究<code>nextResponder</code></h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, (int64_t) (<span class="number">2</span> * <span class="built_in">NSEC_PER_SEC</span>));</span><br><span class="line">    dispatch_after(time, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="built_in">UIResponder</span> *responder = <span class="keyword">self</span>.dView.nextResponder;</span><br><span class="line">        <span class="built_in">NSMutableString</span> *pre = [<span class="built_in">NSMutableString</span> stringWithString:<span class="string">@&quot;--&quot;</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span>.dView <span class="keyword">class</span>]));</span><br><span class="line">        <span class="keyword">while</span> (responder) &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;%@%@&quot;</span>, pre, <span class="built_in">NSStringFromClass</span>([responder <span class="keyword">class</span>]));</span><br><span class="line">            [pre appendString:<span class="string">@&quot;--&quot;</span>];</span><br><span class="line">            responder =  responder.nextResponder;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-logs"><a href="#3-3-2-logs" class="headerlink" title="3.3.2 logs"></a>3.3.2 logs</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">54.761528</span>+<span class="number">0800</span> ResponserChain[<span class="number">4933</span>:<span class="number">159322</span>] DView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">54.761673</span>+<span class="number">0800</span> ResponserChain[<span class="number">4933</span>:<span class="number">159322</span>] --CView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">54.761815</span>+<span class="number">0800</span> ResponserChain[<span class="number">4933</span>:<span class="number">159322</span>] ----AView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">54.761925</span>+<span class="number">0800</span> ResponserChain[<span class="number">4933</span>:<span class="number">159322</span>] ------ViewController</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">54.762091</span>+<span class="number">0800</span> ResponserChain[<span class="number">4933</span>:<span class="number">159322</span>] --------UIDropShadowView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">54.762209</span>+<span class="number">0800</span> ResponserChain[<span class="number">4933</span>:<span class="number">159322</span>] ----------UITransitionView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">54.762328</span>+<span class="number">0800</span> ResponserChain[<span class="number">4933</span>:<span class="number">159322</span>] ------------UIWindow</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">54.762424</span>+<span class="number">0800</span> ResponserChain[<span class="number">4933</span>:<span class="number">159322</span>] --------------UIWindowScene</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">54.762700</span>+<span class="number">0800</span> ResponserChain[<span class="number">4933</span>:<span class="number">159322</span>] ----------------UIApplication</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">54.763049</span>+<span class="number">0800</span> ResponserChain[<span class="number">4933</span>:<span class="number">159322</span>] ------------------AppDelegate</span><br></pre></td></tr></table></figure>

<h3 id="3-3-3-注意点"><a href="#3-3-3-注意点" class="headerlink" title="3.3.3 注意点"></a>3.3.3 注意点</h3><ul>
<li>我们在<code>3.3.1</code>查找<code>nextResnponder</code>时，将方法延时执行的，若直接在<code>ViewController</code>的<code>viewDidLoad</code>中，<code>nextResponder</code>将在<code>ViewController</code> 中结束。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">45.560602</span>+<span class="number">0800</span> ResponserChain[<span class="number">5275</span>:<span class="number">168169</span>] DView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">45.560739</span>+<span class="number">0800</span> ResponserChain[<span class="number">5275</span>:<span class="number">168169</span>] --CView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">45.560852</span>+<span class="number">0800</span> ResponserChain[<span class="number">5275</span>:<span class="number">168169</span>] ----AView</span><br><span class="line"><span class="number">2022</span><span class="number">-02</span><span class="number">-27</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">45.560952</span>+<span class="number">0800</span> ResponserChain[<span class="number">5275</span>:<span class="number">168169</span>] ------ViewController</span><br></pre></td></tr></table></figure>

<p>从这里推理出我们响应者树的构造过程是在 ViewDidLoad 周期中来完成的，这个函数会将当前实例的构成的响应者子树合并到我们整个根树中</p>
<p>根据<code>logs</code>我们得出，<code>ResponderChain</code>是<code>自上而下</code>的即<code>AppDelegate-&gt;UIApplication-&gt;UIWindowSece-&gt;UIWindow-&gt;ViewController-&gt;AView-&gt;CView-&gt;DView</code>.事件处理的顺序将是自下而上而上，由<code>ResponderChain</code>的逆向传递去处理的。因为想看到事件传递的全过程，我们这边并没有去处理<code>touch</code>事件，下面我们将处理事件来验证事件处理的过程。</p>
<h3 id="3-3-4-事件处理"><a href="#3-3-4-事件处理" class="headerlink" title="3.3.4 事件处理"></a>3.3.4 事件处理</h3><p>我们在<code>A</code>View 上来处理<code>touch/(begain/cancel/move/end)</code>事件，<code>overwrite</code>前面的方法。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%@ touchBegin&quot;</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span>  <span class="keyword">class</span>]));</span><br><span class="line">    [<span class="variable language_">super</span> touchesBegan:touches withEvent:event];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)touchesMoved:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%@ toucheModed&quot;</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]));</span><br><span class="line">    [<span class="variable language_">super</span> touchesMoved:touches withEvent:event];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)touchesEnded:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%@  touchEnded&quot;</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]));</span><br><span class="line">    [<span class="variable language_">super</span> touchesEnded:touches withEvent:event];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)touchesCancelled:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%@ touchCanclled&quot;</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]));</span><br><span class="line">    [<span class="variable language_">super</span> touchesCancelled:touches withEvent:event];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>我们得到下面的 log</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2022-02-27 10:42:08.346133+0800 ResponserChain[6196:190756] UIWindow hitTest return DView</span><br><span class="line">2022-02-27 10:42:08.347626+0800 ResponserChain[6196:190756] AView touchBegin</span><br><span class="line">2022-02-27 10:42:08.439185+0800 ResponserChain[6196:190756] AView  touchEnded</span><br></pre></td></tr></table></figure>

<p>若我们在 DView 中添加手势，并且不去实现<code>touch</code>的方法，那又会发生什么呢</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">void</span>)awakeFromNib &#123;</span><br><span class="line">    [<span class="variable language_">super</span> awakeFromNib];</span><br><span class="line">    [<span class="keyword">self</span> addGestureRecognizer:[[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(tapAction:)]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)tapAction:(<span class="built_in">UITapGestureRecognizer</span> *)tapReg &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%@ DView taped&quot;</span>, tapReg.self);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2022-02-27 11:06:06.307171+0800 ResponserChain[6932:210072] UIWindow hitTest return DView</span><br><span class="line">2022-02-27 11:06:06.308727+0800 ResponserChain[6932:210072] AView touchBegin</span><br><span class="line">2022-02-27 11:06:06.377668+0800 ResponserChain[6932:210072] &lt;UITapGestureRecognizer: 0x7f7a747078c0; state = Ended; view = &lt;DView 0x7f7a74708b40&gt;; target= &lt;(action=tapAction:, target=&lt;DView 0x7f7a74708b40&gt;)&gt;&gt; DView taped</span><br><span class="line">2022-02-27 11:06:06.377883+0800 ResponserChain[6932:210072] AView touchCanclled</span><br></pre></td></tr></table></figure>

<h3 id="3-3-5-总结"><a href="#3-3-5-总结" class="headerlink" title="3.3.5 总结"></a>3.3.5 总结</h3><p>我们得到下面结论<br>1、响应者链找出最佳响应者<code>firstResopnder</code>-&gt;DView<br>2、DView 顺着响应者链，找到合适的处理者<code>AView</code>(实现了<code>touch</code>）方法。 （DView 有视图，会根据 nextResponder 寻找到 CView，发现 C 没有处理，C 会根据 nextResponder 找到 A，结果发现 A 处理了那那么事件传递到此结束）<br>3、若本例中的 A 没有处理，会向上找到<code>ViewController</code>,若还是找不到会沿着<code>响应者链</code>一直向上传递，知道 AppDelegate 也不处理。那么这个事件将被废弃掉。</p>
<h2 id="4-应用场景"><a href="#4-应用场景" class="headerlink" title="4.应用场景"></a>4.应用场景</h2><h3 id="4-1-无法响应"><a href="#4-1-无法响应" class="headerlink" title="4.1 无法响应"></a>4.1 无法响应</h3><p>无法响应即不调用<code>hitTest</code>的状况，主要有以下几点</p>
<ul>
<li>子视图超越父视图</li>
<li>视图不透明度小于 0.01</li>
<li>userInteraction 为 false</li>
<li>视图被隐藏</li>
</ul>
<h3 id="4-2-自定义-tabbar-的-button-超过-tabbar-的视图，扩大-button-的点击范围"><a href="#4-2-自定义-tabbar-的-button-超过-tabbar-的视图，扩大-button-的点击范围" class="headerlink" title="4.2 自定义 tabbar 的 button 超过 tabbar 的视图，扩大 button 的点击范围"></a>4.2 自定义 tabbar 的 button 超过 tabbar 的视图，扩大 button 的点击范围</h3><h3 id="4-3-圆形背景图-button-缩小点击范围"><a href="#4-3-圆形背景图-button-缩小点击范围" class="headerlink" title="4.3 圆形背景图 button 缩小点击范围"></a>4.3 圆形背景图 button 缩小点击范围</h3><h3 id="4-4-点击穿透"><a href="#4-4-点击穿透" class="headerlink" title="4.4 点击穿透"></a>4.4 点击穿透</h3><p>篇幅有限，关于案例中问题；可以自行百度。考查的知识点也可以从上述的篇幅中找到答案。</p>
<h2 id="5-参考文献"><a href="#5-参考文献" class="headerlink" title="5.参考文献"></a>5.参考文献</h2><ul>
<li><a href="iOS%E5%93%8D%E5%BA%94%E8%80%85%E9%93%BE%E5%BD%BB%E5%BA%95%E6%8E%8C%E6%8F%A1">iOS 响应者链彻底掌握</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/uikit/uiresponder/1621099-nextresponder">Apple_Event Handling Guide for UIKit Apps</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/iOS-mt/p/4197256.html">Responder 一点也不神秘————iOS 用户响应者链完全剖析</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jeversonjee.github.io/blog/2022/02/25/ios/hittest/" data-id="clanvjj9k00012c45fpmr41nx" data-title="iOS 响应者链条" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/2022/09/29/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          Hello World
        
      </div>
    </a>
  
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/02/">February 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2022/11/19/react-native/comunation/">native和react-native通信</a>
          </li>
        
          <li>
            <a href="/blog/2022/09/29/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/blog/2022/02/25/ios/hittest/">iOS 响应者链条</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 jeversonjee<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/blog/js/jquery-3.4.1.min.js"></script>



  
<script src="/blog/fancybox/jquery.fancybox.min.js"></script>




<script src="/blog/js/script.js"></script>





  </div>
</body>
</html>